<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Building a cloud-friendly application</title>
  <meta name="author" content="Larry Garfield">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="platform-reveal/platform-theme/assets/css/styles.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'platform-theme/assets/css/print/pdf.css' : 'platform-theme/assets/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>

  <script src="platform-reveal/classer.js"></script>

  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->

  <style type="text/css">

    img.graphic {
    }

    ul.inline {
      margin: 0;
      padding: 0;
      list-style-type: none;
      text-align: center;
    }

    ul.inline li {
      display: inline;
    }

    /*overwrites a default style that
    vertically un-centered slides */
    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0;
    }

    .reveal h2 + p.bigtext,
    .reveal p + p,
    .reveal h3 + p,
    .reveal h3 + h3 {
      margin-top: 1em;
    }

    .reveal #final p + p {
      margin-top: 0;
    }

    .struck {
      text-decoration: line-through;
    }

    p.bigdeal {
      font-size: 200%;
      color: Red;
      font-style: italic;
      text-shadow: 3px 3px 10px #990000;
      display: block;
    }

    img.screenshot {
      border-radius: 5px;
      width: 900px;
    }

    blockquote em {
      color: Green;
      font-weight: bold !important;
    }

  </style>

</head>
<!-- Change body class to "dark" if you prefer a dark theme, or "light" if you'd rather have a light theme-->
<body class="light">
<div class="reveal">
  <div class="logo">
    <p>Platform.sh</p>
  </div>
  <!-- Any section element inside of this container is displayed as a slide -->
  <div class="slides">

    <section>
      <h2>Building a cloud-friendly application</h2>
      <p>
        <small>Presented by <a href="http://www.garfieldtech.com/">Larry Garfield</a> (<a href="http://twitter.com/Crell">@Crell</a>)</small>
      </p>
    </section>
    <section class="l-2up">
      <h2><a href="http://twitter.com/Crell">@Crell</a></h2>
      <div>
        <img src="assets/larry-olaf-hug.jpg" alt="Larry implements Huggable" style="width: 350px; margin: 0" />
      </div>
      <div>
        <ul style="text-wrap: none">
          <li>Director of DX, <a href="http://www.platform.sh/">Platform.sh</a></li>
          <li style="margin-top: 1em;">PHP-FIG Core Committee</li>
          <li style="margin-top: 1em;"><code>implements Huggable</code></li>
        </ul>
      </div>
    </section>
    <section>
      <section>
        <p>Cloud picture</p>
        <aside class="notes">
          <ul>
            <li>Not those clouds</li>
            <li>Work at Platform.sh, behind SymfonyCloud</li>
            <li>Work with lots of apps, good and bad.</li>
          </ul>
        </aside>
      </section>
      <section>
        <img src="assets/cloud-eating-world.jpg" alt="Software is eating the world, and cloud is eating software." data-credit="https://twitter.com/bassamtabbara/status/921784412479545344" />
        <small>(Source: <a href="https://twitter.com/bassamtabbara/status/921784412479545344">@bassamtabbara</a>)</small>
        <aside class="notes">
          <ul>
            <li>Cloud-based hosting is the big thing</li>
            <li>What is a cloud, and what's it mean?</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <section>
        <h3>What is cloud computing?</h3>
        <h3 class="fragment">What is the cloud?</h3>
        <p class="fragment">These are separate questions...</p>
      </section>
      <section>
        <h2>The Cloud&trade;: noun</h2>
        <p class="bigtext">Someone else's hard drive</p>
        <aside class="notes">
          <ul>
            <li>Marketing term</li>
            <li>Business model: outsourcing</li>
            <li>Not going to get into that</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Cloud computing: noun</h2>
        <p class="bigtext">Abstracting away physical infrastructure</p>
        <p class="bigtext fragment">Disposable application design</p>
        <aside class="notes">
          <ul>
            <li>Often but not always in The Cloud</li>
            <li>Logical "systems", not physical boxen</li>
            <li>Systems are "cattle", so are app instances</li>
          </ul>
        </aside>
      </section>
      <section>
        <h3>What makes an application cloud-friendly?</h3>
      </section>
      <section>
        <h3>They're not rules</h3>
        <img src="assets/captain-barbados.gif" width="70%" alt="They're more like guidelines..." data-credit="http://www.killerfilm.com/articles-2/read/captain-barbados-confirmed-for-pirates-4-14377" />
        <h3>They're more like guidelines</h3>
      </section>
    </section>
    <section>
      <section class="l-2up">
        <!-- Reformat this slide, ugh. -->
        <h2>Split code from content</h2>
        <div class="fragment">
          <h3>Code</h3>
          <ul>
            <li>Provided by developer</li>
            <li>Carefully tested</li>
            <li>Lives in version control</li>
            <li>Read-only runtime</li>
          </ul>
        </div>
        <div class="fragment">
          <h3>Content</h3>
          <ul>
            <li>Provided by users</li>
            <li>Frequently ad hoc</li>
            <li>Lives in DB or filesystem</li>
            <li>Writeable runtime</li>
          </ul>
        </div>
        <div class="fragment">Don't mix the filesystems</div>
        <aside class="notes">
          <ul>
            <li>RO FS for security, audit, don't edit prod</li>
            <li>Split by directory</li>
            <li>S3 an option, not requirement</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="bigtext">Your application is disposable. Your data is not.</p>
      </section>
      <section>
        <h3>Data flow</h3>
        <!-- pic of code flowing up, data flowing down -->
        <p class="fragment">You don't get an in-between option</p>
      </section>
      <section>
        <h3>Take-away</h3>
        <p>Cleanly separate "Dev provided" and "user provided" files</p>
      </section>
    </section>
    <section>
      <section>
        <h3>What is configuration?</h3>
      </section>
      <section>
        <p>Does config come from the developer or the user?</p>
        <p class="fragment">Git or Database?</p>
        <aside class="notes">
          <ul>
            <li>Not usually an issue for bespoke apps</li>
            <li>CMSes, often</li>
          </ul>
        </aside>
      </section>
      <section class="l--2up">
        <h2>Drupal Config Management</h2>
        <img src="assets/drupal-8-logo.png" alt="Drupal 8" width="30%" />
        <ol>
          <li>Configure in UI / DB</li>
          <li>Export to YAML</li>
          <li>Commit to Git</li>
          <li>Push / Pull</li>
          <li>Import back to DB</li>
        </ol>
        <aside class="notes">
          <ul>
            <li>Works, but over-engineered for most</li>
            <li>Decide where it originates and be done with it</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Decide</h2>
        <aside class="notes">
          <ul>
            <li>Doesn't matter which, but pick one</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <section>
        <h2>What happens at runtime<br />stays at runtime</h2>
      </section>
      <section>
        <p>Picture of application slotting into environment</p>
        <aside class="notes">
          <ul>
            <li>Application separate from env</li>
            <li>Dev/Stage/Prod, Testing, multi-head, auto-scaling, etc.</li>
            <li>Assume nothing about your environment!</li>
          </ul>
        </aside>
      </section>
      <section>
        <h3>Dependency inject your environment</h3>
        <ul>
          <li class="fragment">DB credentials <span class="fragment">(Solr, Redis, etc.)</span></li>
          <li class="fragment">API keys</li>
          <li class="fragment">All paths on disk</li>
          <li class="fragment">Domain names</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>Any service, internal or external</li>
            <li>Ideally you never know credentials and keys</li>
            <li>Paths relative to root OK, but root is injected</li>
            <li>Paths and domain names in DB = bad</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Environment variables</h2>
        <pre class="font--24"><code class="php" data-trim>
getenv('foo');

$_ENV['foo'];

$_ENV['foo']['bar'];
        </code></pre>
        <aside class="notes">
          <ul>
            <li>All env injected this way</li>
            <li>Don't always control them exactly</li>
            <li>Host may have own format, app has own format</li>
          </ul>
        </aside>
      </section>
      <section>
        <p class="bigtext">Need glue code</p>
        <aside class="notes">
          <ul>
            <li>Translate host env vars to app env vars</li>
          </ul>
        </aside>
      </section>
      <section>
        <h2>Platform.sh / SymfonyCloud</h2>
        <pre class="font--18"><code class="php" data-trim>
// platform_parameters.php
// Configure the database.
if (isset($_ENV['PLATFORM_RELATIONSHIPS'])) {
    $dbRelationshipName = 'database';
    $relationships = json_decode(base64_decode($_ENV['PLATFORM_RELATIONSHIPS']), true);

    foreach ($relationships[$dbRelationshipName] as $endpoint) {
        if (!empty($endpoint['query']['is_master'])) {
            $container->setParameter('database_driver', 'pdo_'.$endpoint['scheme']);
            $container->setParameter('database_host', $endpoint['host']);
            $container->setParameter('database_port', $endpoint['port']);
            $container->setParameter('database_name', $endpoint['path']);
            $container->setParameter('database_user', $endpoint['username']);
            $container->setParameter('database_password', $endpoint['password']);
            $container->setParameter('database_path', '');
            break;
        }
    }
}
// Set a default unique secret, based on a project-specific entropy value.
if (isset($_ENV['PLATFORM_PROJECT_ENTROPY'])) {
    $container->setParameter('kernel.secret', $_ENV['PLATFORM_PROJECT_ENTROPY']);
}
        </code></pre>
      </section>
      <section>
        <ul>
          <li><code>Request::setTrustedHosts()</code></li>
        </ul>
        <aside class="notes">
          <ul>
            <li>Trusted host will vary depending on dev/stage/prod</li>
            <li>Never put domain in the DB.</li>
          </ul>
        </aside>
      </section>
      <section>
        Stuff about Symfony here
      </section>
      <section>
        <h3><code id="constants">Constants?</code></h3>
        <span class="fragment" data-classer="constants" data-classer-class="struck"></span>
        <aside class="notes">
          <ul>
            <li>Globals</li>
            <li>Make overriding harder (for local dev)</li>
            <li>Make testing harder</li>
          </ul>
        </aside>
      </section>
    </section>
    <section>
      <section>
        <h3>User-configured connections</h3>
      </section>
      <section>
        <h3>Installers</h3>
        <ul>
          <li></li>
        </ul>
      </section>
    </section>

    <div style="display:none">

      * Runtime
        * Application needs to run in different environments
        * Prod, multi-head, staging, other staging, your laptop, colleague's laptop, testing, etc.
        * Assume nothing about the environment!
        * Dependency inject your environment
        * Environment: Credentials, paths, domains
        * environment variables
        * Ask Damien about env var alternative?


      * What is a cloud host?
        * Infra is abstracted away from you
        * Disposable applications

      * Split code from content
      * Configuration is code or content
        * Ref Drupal?
        * For SF, mostly code.
      * Runtime connections
        * Env vars
        * place for glue
        * Ref Symfony?
        * Need to discuss env component here
        * Constants for config suck
          * Can't easily override, makes glue harder
      * Installers
        * No disk write
        * Allow pre-defined creds
        * Even UI services need code-provided creds
      * Relative paths
      * Boot fast
        * PHP's got this covered
        * Cache warm in build if you can
        * Allow lazy-cache building
      * No services build
        * Don't assume number of webheads

      * Don't use cloud-specific proprietary tools.
        * Be able to move.


    </div>

    <section id="final">
      <h2>Larry Garfield</h2>
      <h2><a href="http://twitter.com/Crell">@Crell</a></h2>
      <p>Director of Developer Experience <a href="http://www.platform.sh/">Platform.sh</a></p>
      <p>Continuous Deployment Cloud Hosting</p>
      <p>Stalk us at <a href="http://twitter.com/Platformsh">@PlatformSH</a></p>
    </section>

  </div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

  // Full list of configuration options available at:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,

    transition: 'slide', // none/fade/slide/convex/concave/zoom

    // Optional reveal.js plugins
    dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'plugin/zoom-js/zoom.js', async: true },
      { src: 'plugin/notes/notes.js', async: true }
    ]
  });

</script>

</body>
</html>
